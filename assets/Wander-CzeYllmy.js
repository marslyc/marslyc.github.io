import{c as h,a3 as ue,a4 as te,a5 as fe,a6 as Y,a7 as pe,a8 as me,S as we,r as Q,W as ye,v as xe,p as be,q as ge,G as Me,g as Se,H as Z,M as $,X as Te,O as ee,a9 as ze,I as ve,aa as ke,ab as Pe,l as Le}from"./three.module-BMQevBqr.js";import{G as Ae}from"./GLTFLoader-DDEeVYJp.js";import{_ as We,r as _e,o as Be,g as Ce,c as Ie,a as De}from"./index-DSZOP8Kz.js";class F{constructor(e=new h(0,0,0),t=new h(0,1,0),s=1){this.start=e,this.end=t,this.radius=s}clone(){return new F(this.start.clone(),this.end.clone(),this.radius)}set(e,t,s){this.start.copy(e),this.end.copy(t),this.radius=s}copy(e){this.start.copy(e.start),this.end.copy(e.end),this.radius=e.radius}getCenter(e){return e.copy(this.end).add(this.start).multiplyScalar(.5)}translate(e){this.start.add(e),this.end.add(e)}checkAABBAxis(e,t,s,i,n,a,r,d,l){return(n-e<l||n-s<l)&&(e-a<l||s-a<l)&&(r-t<l||r-i<l)&&(t-d<l||i-d<l)}intersectsBox(e){return this.checkAABBAxis(this.start.x,this.start.y,this.end.x,this.end.y,e.min.x,e.max.x,e.min.y,e.max.y,this.radius)&&this.checkAABBAxis(this.start.x,this.start.z,this.end.x,this.end.z,e.min.x,e.max.x,e.min.z,e.max.z,this.radius)&&this.checkAABBAxis(this.start.y,this.start.z,this.end.y,this.end.z,e.min.y,e.max.y,e.min.z,e.max.z,this.radius)}}const B=new h,C=new h,O=new h,I=new h,g=new ue,j=new te,Ee=new te,R=new fe,D=new F,Ge=new h,Oe=new h,Re=new h,Fe=1e-10;function He(v,e,t=null,s=null){const i=Ge.copy(v.end).sub(v.start),n=Oe.copy(e.end).sub(e.start),a=Re.copy(e.start).sub(v.start),r=i.dot(n),d=i.dot(i),l=n.dot(n),w=n.dot(a),k=i.dot(a);let y,x;const P=d*l-r*r;if(Math.abs(P)<Fe){const b=-w/l,p=(r-w)/l;Math.abs(b-.5)<Math.abs(p-.5)?(y=0,x=b):(y=1,x=p)}else y=(w*r+k*l)/P,x=(y*r-w)/l;x=Math.max(0,Math.min(1,x)),y=Math.max(0,Math.min(1,y)),t&&t.copy(i).multiplyScalar(y).add(v.start),s&&s.copy(n).multiplyScalar(x).add(e.start)}class U{constructor(e){this.box=e,this.bounds=new Y,this.subTrees=[],this.triangles=[],this.layers=new pe}addTriangle(e){return this.bounds.min.x=Math.min(this.bounds.min.x,e.a.x,e.b.x,e.c.x),this.bounds.min.y=Math.min(this.bounds.min.y,e.a.y,e.b.y,e.c.y),this.bounds.min.z=Math.min(this.bounds.min.z,e.a.z,e.b.z,e.c.z),this.bounds.max.x=Math.max(this.bounds.max.x,e.a.x,e.b.x,e.c.x),this.bounds.max.y=Math.max(this.bounds.max.y,e.a.y,e.b.y,e.c.y),this.bounds.max.z=Math.max(this.bounds.max.z,e.a.z,e.b.z,e.c.z),this.triangles.push(e),this}calcBox(){return this.box=this.bounds.clone(),this.box.min.x-=.01,this.box.min.y-=.01,this.box.min.z-=.01,this}split(e){if(!this.box)return;const t=[],s=C.copy(this.box.max).sub(this.box.min).multiplyScalar(.5);for(let n=0;n<2;n++)for(let a=0;a<2;a++)for(let r=0;r<2;r++){const d=new Y,l=B.set(n,a,r);d.min.copy(this.box.min).add(l.multiply(s)),d.max.copy(d.min).add(s),t.push(new U(d))}let i;for(;i=this.triangles.pop();)for(let n=0;n<t.length;n++)t[n].box.intersectsTriangle(i)&&t[n].triangles.push(i);for(let n=0;n<t.length;n++){const a=t[n].triangles.length;a>8&&e<16&&t[n].split(e+1),a!==0&&this.subTrees.push(t[n])}return this}build(){return this.calcBox(),this.split(0),this}getRayTriangles(e,t){for(let s=0;s<this.subTrees.length;s++){const i=this.subTrees[s];if(e.intersectsBox(i.box))if(i.triangles.length>0)for(let n=0;n<i.triangles.length;n++)t.indexOf(i.triangles[n])===-1&&t.push(i.triangles[n]);else i.getRayTriangles(e,t)}return t}triangleCapsuleIntersect(e,t){t.getPlane(g);const s=g.distanceToPoint(e.start)-e.radius,i=g.distanceToPoint(e.end)-e.radius;if(s>0&&i>0||s<-e.radius&&i<-e.radius)return!1;const n=Math.abs(s/(Math.abs(s)+Math.abs(i))),a=B.copy(e.start).lerp(e.end,n);if(t.containsPoint(a))return{normal:g.normal.clone(),point:a.clone(),depth:Math.abs(Math.min(s,i))};const r=e.radius*e.radius,d=j.set(e.start,e.end),l=[[t.a,t.b],[t.b,t.c],[t.c,t.a]];for(let w=0;w<l.length;w++){const k=Ee.set(l[w][0],l[w][1]);if(He(d,k,O,I),O.distanceToSquared(I)<r)return{normal:O.clone().sub(I).normalize(),point:I.clone(),depth:e.radius-O.distanceTo(I)}}return!1}triangleSphereIntersect(e,t){if(t.getPlane(g),!e.intersectsPlane(g))return!1;const s=Math.abs(g.distanceToSphere(e)),i=e.radius*e.radius-s*s,n=g.projectPoint(e.center,B);if(t.containsPoint(e.center))return{normal:g.normal.clone(),point:n.clone(),depth:Math.abs(g.distanceToSphere(e))};const a=[[t.a,t.b],[t.b,t.c],[t.c,t.a]];for(let r=0;r<a.length;r++){j.set(a[r][0],a[r][1]),j.closestPointToPoint(n,!0,C);const d=C.distanceToSquared(e.center);if(d<i)return{normal:e.center.clone().sub(C).normalize(),point:C.clone(),depth:e.radius-Math.sqrt(d)}}return!1}getSphereTriangles(e,t){for(let s=0;s<this.subTrees.length;s++){const i=this.subTrees[s];if(e.intersectsBox(i.box))if(i.triangles.length>0)for(let n=0;n<i.triangles.length;n++)t.indexOf(i.triangles[n])===-1&&t.push(i.triangles[n]);else i.getSphereTriangles(e,t)}}getCapsuleTriangles(e,t){for(let s=0;s<this.subTrees.length;s++){const i=this.subTrees[s];if(e.intersectsBox(i.box))if(i.triangles.length>0)for(let n=0;n<i.triangles.length;n++)t.indexOf(i.triangles[n])===-1&&t.push(i.triangles[n]);else i.getCapsuleTriangles(e,t)}}sphereIntersect(e){R.copy(e);const t=[];let s,i=!1;this.getSphereTriangles(e,t);for(let n=0;n<t.length;n++)(s=this.triangleSphereIntersect(R,t[n]))&&(i=!0,R.center.add(s.normal.multiplyScalar(s.depth)));if(i){const n=R.center.clone().sub(e.center),a=n.length();return{normal:n.normalize(),depth:a}}return!1}capsuleIntersect(e){D.copy(e);const t=[];let s,i=!1;this.getCapsuleTriangles(D,t);for(let n=0;n<t.length;n++)(s=this.triangleCapsuleIntersect(D,t[n]))&&(i=!0,D.translate(s.normal.multiplyScalar(s.depth)));if(i){const n=D.getCenter(new h).sub(e.getCenter(B)),a=n.length();return{normal:n.normalize(),depth:a}}return!1}rayIntersect(e){if(e.direction.length()===0)return;const t=[];let s,i,n=1e100;this.getRayTriangles(e,t);for(let a=0;a<t.length;a++){const r=e.intersectTriangle(t[a].a,t[a].b,t[a].c,!0,B);if(r){const d=r.sub(e.origin).length();n>d&&(i=r.clone().add(e.origin),n=d,s=t[a])}}return n<1e100?{distance:n,triangle:s,position:i}:!1}fromGraphNode(e){return e.updateWorldMatrix(!0,!0),e.traverse(t=>{if(t.isMesh===!0&&this.layers.test(t.layers)){let s,i=!1;t.geometry.index!==null?(i=!0,s=t.geometry.toNonIndexed()):s=t.geometry;const n=s.getAttribute("position");for(let a=0;a<n.count;a+=3){const r=new h().fromBufferAttribute(n,a),d=new h().fromBufferAttribute(n,a+1),l=new h().fromBufferAttribute(n,a+2);r.applyMatrix4(t.matrixWorld),d.applyMatrix4(t.matrixWorld),l.applyMatrix4(t.matrixWorld),this.addTriangle(new me(r,d,l))}i&&s.dispose()}}),this.build(),this}clear(){return this.box=null,this.bounds.makeEmpty(),this.subTrees.length=0,this.triangles.length=0,this}}const qe={__name:"Wander",setup(v){let e=_e();const t=new we,s=new Q(75,window.innerWidth/window.innerHeight,.1,1e3);s.position.set(0,5,10);const i=new Q(75,window.innerWidth/window.innerHeight,.1,1e3);i.position.set(0,5,-10);const n=new ye;console.log(n,"renderer"),n.setSize(window.innerWidth,window.innerHeight),n.shadowMap.enabled=!0,n.physicallyCorrectLights=!0;const a=new xe(5);t.add(a);let r=new be(16777215,1);t.add(r);let d=new ge(16777215,1);d.castShadow=!0,d.position.set(50,25,10),t.add(d);let l=new Me,w=new Se(1e3,1e3),k=new Z({color:16777215}),y=new $(w,k);y.rotation.x=-Math.PI/2,y.receiveShadow=!0,l.add(y);let x=(o,c)=>Math.floor(Math.random()*(c-o))+o;for(let o=0;o<100;o++){let c=x(2,5),u=x(2,5),f=new Te(c,c,u),J=new Z({color:16711680}),N=new $(f,J);N.position.set(x(-100,100),u/2,x(-100,100)),N.castShadow=!0,l.add(N)}t.add(l);const P=new U;P.fromGraphNode(l);let b=new F(new h(0,.35,0),new h(0,1.35,0),.35);const p=new ee;p.position.set(0,0,0),t.add(p),s.position.set(0,2,-5),s.lookAt(p.position),i.position.set(0,2,5),i.lookAt(p.position);let M=new ee;M.add(s),M.add(i),p.add(M);let H=s,ne=-9.8,m=new h(0,0,0),L=new h(0,0,0),q=!1,se=new ze(16777215,4473924,1);t.add(se);let E=null,ie=new URL("/assets/RobotExpressive-BhJ5TM2m.glb",import.meta.url).href,T={};new Ae().load(ie,o=>{o.scene,o.scene.scale.set(.5,.5,.5),o.scene.position.set(0,-.95,0),p.add(o.scene);let c=o.animations;E=new ve(o.scene),c.forEach((u,f)=>{let J=E.clipAction(u);T[u.name]=J,u.name=="Idle"||u.name=="Running"||u.name=="Walking"?(T[u.name].clampWhenFinished=!1,T[u.name].loop=ke):(T[u.name].clampWhenFinished=!0,T[u.name].loop=Pe)}),o.scene.traverse(u=>{u.castShadow=!0})});let A=null,G=null,z=(o,c=.3)=>{G=A,A=T[o],G!=A&&(G&&G.fadeOut(c),A&&A.reset().setEffectiveTimeScale(1).setEffectiveWeight(1).fadeIn(c).play())},W=!1,_=!1,S={},V=!1,oe=()=>{_||W||S.keyt&&z("Wave",.5)},ae=o=>{let c=T[o],u=c.getClip();return c&&u?u.duration:0};window.addEventListener("keydown",o=>{let c=o.code.toLocaleLowerCase();c=="space"&&!W&&(W=!0,z("Jump")),c=="keyj"&&!_&&(_=!0,z("Dance")),c=="keyk"&&_&&(_=!1),S[c]=!0,V=!0}),window.addEventListener("keyup",o=>{let c=o.code.toLocaleLowerCase();c=="space"&&W&&setTimeout(()=>{W=!1},ae("Jump")*800),S[c]=!1,V=!1,c=="keyv"&&(H=H==s?i:s)}),window.addEventListener("mousemove",o=>{p.rotation.y-=o.movementX*.003,M.rotation.x+=o.movementY*.003,M.rotation.x>Math.PI/8?M.rotation.x=Math.PI/8:M.rotation.x<-Math.PI/8&&(M.rotation.x=-Math.PI/8)}),window.addEventListener("mousedown",o=>{document.body.requestPointerLock()});let re=o=>{let c=new h;if(p.getWorldDirection(c),new h,new h(0,0,.06).length(),S.keyw){L.z=1;let f=new h(0,0,0);p.getWorldDirection(f),m.add(f.multiplyScalar(o))}else if(S.keys){L.z=1;let f=new h(0,0,0);p.getWorldDirection(f),m.add(f.multiplyScalar(-o))}else if(S.keya){L.z=1;let f=new h(0,0,0);p.getWorldDirection(f),f.cross(p.up),m.add(f.multiplyScalar(-o))}else if(S.keyd){L.z=1;let f=new h(0,0,0);p.getWorldDirection(f),f.cross(p.up),m.add(f.multiplyScalar(o))}S.space&&(m.y=8)},le=()=>{let o=P.capsuleIntersect(b);q=!1,o&&(q=o.normal.y>0,b.translate(o.normal.multiplyScalar(o.depth)))},ce=o=>{let c=-.05;q?(m.y=0,V||m.addScaledVector(m,c)):m.y+=ne*o;let u=m.clone().multiplyScalar(o);b.translate(u),b.getCenter(p.position),le();let f=Math.abs(m.x)+Math.abs(m.z);f>.1&&f<=5?z("Walking"):f>5?z("Running"):z("Idle")},de=()=>{p.position.y<-20&&(b.start.set(0,2.35,0),b.end.set(0,3.35,0),b.radius=.35,m.set(0,0,0),L.set(0,0,0))};const he=new Le;let X=()=>{s.aspect=window.innerWidth/window.innerHeight,s.updateProjectionMatrix(),n.setSize(window.innerWidth,window.innerHeight),n.setPixelRatio(window.devicePixelRatio)};Be(()=>{e.value.appendChild(n.domElement)}),Ce(()=>{window.removeEventListener("resize",X)}),window.addEventListener("resize",X);function K(){let o=he.getDelta();re(o),ce(o),de(),E&&(E.update(o),oe()),n.render(t,H),requestAnimationFrame(K)}return K(),(o,c)=>(De(),Ie("div",{id:"box1",ref_key:"wanderScene",ref:e},null,512))}},Ue=We(qe,[["__scopeId","data-v-5e95d2cf"]]);export{Ue as default};
