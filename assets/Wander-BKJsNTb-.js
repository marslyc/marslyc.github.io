import{c as h,a4 as we,a5 as re,a6 as ye,a7 as te,a8 as xe,a9 as be,S as ge,r as ne,W as ve,v as ke,p as Me,q as Le,G as Pe,g as Se,I as se,M as ie,Y as Te,O as oe,aa as ze,J as Ae,ab as We,ac as Be,l as _e}from"./three.module-A37dimS0.js";import{G as Ce}from"./GLTFLoader-EeHkup_U.js";import{_ as Ee,r as Ie,o as De,f as Re,c as Ge,a as He}from"./index-_YfaVgSB.js";class O{constructor(e=new h(0,0,0),t=new h(0,1,0),s=1){this.start=e,this.end=t,this.radius=s}clone(){return new O(this.start.clone(),this.end.clone(),this.radius)}set(e,t,s){this.start.copy(e),this.end.copy(t),this.radius=s}copy(e){this.start.copy(e.start),this.end.copy(e.end),this.radius=e.radius}getCenter(e){return e.copy(this.end).add(this.start).multiplyScalar(.5)}translate(e){this.start.add(e),this.end.add(e)}checkAABBAxis(e,t,s,i,n,r,l,d,c){return(n-e<c||n-s<c)&&(e-r<c||s-r<c)&&(l-t<c||l-i<c)&&(t-d<c||i-d<c)}intersectsBox(e){return this.checkAABBAxis(this.start.x,this.start.y,this.end.x,this.end.y,e.min.x,e.max.x,e.min.y,e.max.y,this.radius)&&this.checkAABBAxis(this.start.x,this.start.z,this.end.x,this.end.z,e.min.x,e.max.x,e.min.z,e.max.z,this.radius)&&this.checkAABBAxis(this.start.y,this.start.z,this.end.y,this.end.z,e.min.y,e.max.y,e.min.z,e.max.z,this.radius)}}const _=new h,C=new h,H=new h,E=new h,g=new we,U=new re,qe=new re,q=new ye,I=new O,Oe=new h,Fe=new h,Je=new h,Ve=1e-10;function Ne(P,e,t=null,s=null){const i=Oe.copy(P.end).sub(P.start),n=Fe.copy(e.end).sub(e.start),r=Je.copy(e.start).sub(P.start),l=i.dot(n),d=i.dot(i),c=n.dot(n),w=n.dot(r),S=i.dot(r);let y,x;const T=d*c-l*l;if(Math.abs(T)<Ve){const b=-w/c,m=(l-w)/c;Math.abs(b-.5)<Math.abs(m-.5)?(y=0,x=b):(y=1,x=m)}else y=(w*l+S*c)/T,x=(y*l-w)/c;x=Math.max(0,Math.min(1,x)),y=Math.max(0,Math.min(1,y)),t&&t.copy(i).multiplyScalar(y).add(P.start),s&&s.copy(n).multiplyScalar(x).add(e.start)}class Y{constructor(e){this.box=e,this.bounds=new te,this.subTrees=[],this.triangles=[],this.layers=new xe}addTriangle(e){return this.bounds.min.x=Math.min(this.bounds.min.x,e.a.x,e.b.x,e.c.x),this.bounds.min.y=Math.min(this.bounds.min.y,e.a.y,e.b.y,e.c.y),this.bounds.min.z=Math.min(this.bounds.min.z,e.a.z,e.b.z,e.c.z),this.bounds.max.x=Math.max(this.bounds.max.x,e.a.x,e.b.x,e.c.x),this.bounds.max.y=Math.max(this.bounds.max.y,e.a.y,e.b.y,e.c.y),this.bounds.max.z=Math.max(this.bounds.max.z,e.a.z,e.b.z,e.c.z),this.triangles.push(e),this}calcBox(){return this.box=this.bounds.clone(),this.box.min.x-=.01,this.box.min.y-=.01,this.box.min.z-=.01,this}split(e){if(!this.box)return;const t=[],s=C.copy(this.box.max).sub(this.box.min).multiplyScalar(.5);for(let n=0;n<2;n++)for(let r=0;r<2;r++)for(let l=0;l<2;l++){const d=new te,c=_.set(n,r,l);d.min.copy(this.box.min).add(c.multiply(s)),d.max.copy(d.min).add(s),t.push(new Y(d))}let i;for(;i=this.triangles.pop();)for(let n=0;n<t.length;n++)t[n].box.intersectsTriangle(i)&&t[n].triangles.push(i);for(let n=0;n<t.length;n++){const r=t[n].triangles.length;r>8&&e<16&&t[n].split(e+1),r!==0&&this.subTrees.push(t[n])}return this}build(){return this.calcBox(),this.split(0),this}getRayTriangles(e,t){for(let s=0;s<this.subTrees.length;s++){const i=this.subTrees[s];if(e.intersectsBox(i.box))if(i.triangles.length>0)for(let n=0;n<i.triangles.length;n++)t.indexOf(i.triangles[n])===-1&&t.push(i.triangles[n]);else i.getRayTriangles(e,t)}return t}triangleCapsuleIntersect(e,t){t.getPlane(g);const s=g.distanceToPoint(e.start)-e.radius,i=g.distanceToPoint(e.end)-e.radius;if(s>0&&i>0||s<-e.radius&&i<-e.radius)return!1;const n=Math.abs(s/(Math.abs(s)+Math.abs(i))),r=_.copy(e.start).lerp(e.end,n);if(t.containsPoint(r))return{normal:g.normal.clone(),point:r.clone(),depth:Math.abs(Math.min(s,i))};const l=e.radius*e.radius,d=U.set(e.start,e.end),c=[[t.a,t.b],[t.b,t.c],[t.c,t.a]];for(let w=0;w<c.length;w++){const S=qe.set(c[w][0],c[w][1]);if(Ne(d,S,H,E),H.distanceToSquared(E)<l)return{normal:H.clone().sub(E).normalize(),point:E.clone(),depth:e.radius-H.distanceTo(E)}}return!1}triangleSphereIntersect(e,t){if(t.getPlane(g),!e.intersectsPlane(g))return!1;const s=Math.abs(g.distanceToSphere(e)),i=e.radius*e.radius-s*s,n=g.projectPoint(e.center,_);if(t.containsPoint(e.center))return{normal:g.normal.clone(),point:n.clone(),depth:Math.abs(g.distanceToSphere(e))};const r=[[t.a,t.b],[t.b,t.c],[t.c,t.a]];for(let l=0;l<r.length;l++){U.set(r[l][0],r[l][1]),U.closestPointToPoint(n,!0,C);const d=C.distanceToSquared(e.center);if(d<i)return{normal:e.center.clone().sub(C).normalize(),point:C.clone(),depth:e.radius-Math.sqrt(d)}}return!1}getSphereTriangles(e,t){for(let s=0;s<this.subTrees.length;s++){const i=this.subTrees[s];if(e.intersectsBox(i.box))if(i.triangles.length>0)for(let n=0;n<i.triangles.length;n++)t.indexOf(i.triangles[n])===-1&&t.push(i.triangles[n]);else i.getSphereTriangles(e,t)}}getCapsuleTriangles(e,t){for(let s=0;s<this.subTrees.length;s++){const i=this.subTrees[s];if(e.intersectsBox(i.box))if(i.triangles.length>0)for(let n=0;n<i.triangles.length;n++)t.indexOf(i.triangles[n])===-1&&t.push(i.triangles[n]);else i.getCapsuleTriangles(e,t)}}sphereIntersect(e){q.copy(e);const t=[];let s,i=!1;this.getSphereTriangles(e,t);for(let n=0;n<t.length;n++)(s=this.triangleSphereIntersect(q,t[n]))&&(i=!0,q.center.add(s.normal.multiplyScalar(s.depth)));if(i){const n=q.center.clone().sub(e.center),r=n.length();return{normal:n.normalize(),depth:r}}return!1}capsuleIntersect(e){I.copy(e);const t=[];let s,i=!1;this.getCapsuleTriangles(I,t);for(let n=0;n<t.length;n++)(s=this.triangleCapsuleIntersect(I,t[n]))&&(i=!0,I.translate(s.normal.multiplyScalar(s.depth)));if(i){const n=I.getCenter(new h).sub(e.getCenter(_)),r=n.length();return{normal:n.normalize(),depth:r}}return!1}rayIntersect(e){if(e.direction.length()===0)return;const t=[];let s,i,n=1e100;this.getRayTriangles(e,t);for(let r=0;r<t.length;r++){const l=e.intersectTriangle(t[r].a,t[r].b,t[r].c,!0,_);if(l){const d=l.sub(e.origin).length();n>d&&(i=l.clone().add(e.origin),n=d,s=t[r])}}return n<1e100?{distance:n,triangle:s,position:i}:!1}fromGraphNode(e){return e.updateWorldMatrix(!0,!0),e.traverse(t=>{if(t.isMesh===!0&&this.layers.test(t.layers)){let s,i=!1;t.geometry.index!==null?(i=!0,s=t.geometry.toNonIndexed()):s=t.geometry;const n=s.getAttribute("position");for(let r=0;r<n.count;r+=3){const l=new h().fromBufferAttribute(n,r),d=new h().fromBufferAttribute(n,r+1),c=new h().fromBufferAttribute(n,r+2);l.applyMatrix4(t.matrixWorld),d.applyMatrix4(t.matrixWorld),c.applyMatrix4(t.matrixWorld),this.addTriangle(new be(l,d,c))}i&&s.dispose()}}),this.build(),this}clear(){return this.box=null,this.bounds.makeEmpty(),this.subTrees.length=0,this.triangles.length=0,this}}const je={__name:"Wander",setup(P){let e=Ie();const t=new ge,s=new ne(75,window.innerWidth/window.innerHeight,.1,1e3);s.position.set(0,5,10);const i=new ne(75,window.innerWidth/window.innerHeight,.1,1e3);i.position.set(0,5,-10);const n=new ve;n.setSize(window.innerWidth,window.innerHeight),n.shadowMap.enabled=!0,n.physicallyCorrectLights=!0;const r=new ke(5);t.add(r);let l=new Me(16777215,1);t.add(l);let d=new Le(16777215,1);d.castShadow=!0,d.position.set(50,25,10),t.add(d);let c=new Pe,w=new Se(1e3,1e3),S=new se({color:16777215}),y=new ie(w,S);y.rotation.x=-Math.PI/2,y.receiveShadow=!0,c.add(y);let x=(o,a)=>Math.floor(Math.random()*(a-o))+o;for(let o=0;o<100;o++){let a=x(2,5),u=x(2,5),f=new Te(a,a,u),N=new se({color:16711680}),j=new ie(f,N);j.position.set(x(-100,100),u/2,x(-100,100)),j.castShadow=!0,c.add(j)}t.add(c);const T=new Y;T.fromGraphNode(c);let b=new O(new h(0,.35,0),new h(0,1.35,0),.35);const m=new oe;m.position.set(0,0,0),t.add(m),s.position.set(0,2,-5),s.lookAt(m.position),i.position.set(0,2,5),i.lookAt(m.position);let v=new oe;v.add(s),v.add(i),m.add(v);let F=s,ae=-9.8,p=new h(0,0,0),z=new h(0,0,0),J=!1,le=new ze(16777215,4473924,1);t.add(le);let D=null,ce=new URL("/assets/RobotExpressive-BhJ5TM2m.glb",import.meta.url).href,k={};new Ce().load(ce,o=>{o.scene,o.scene.scale.set(.5,.5,.5),o.scene.position.set(0,-.95,0),m.add(o.scene);let a=o.animations;D=new Ae(o.scene),a.forEach((u,f)=>{let N=D.clipAction(u);k[u.name]=N,u.name=="Idle"||u.name=="Running"||u.name=="Walking"||u.name=="Dance"?(k[u.name].clampWhenFinished=!1,k[u.name].loop=We):(k[u.name].clampWhenFinished=!1,k[u.name].loop=Be)}),o.scene.traverse(u=>{u.castShadow=!0})});let A=null,R=null,L=(o,a=.3)=>{R=A,A=k[o],R!=A&&(R&&R.fadeOut(a),A&&A.reset().setEffectiveTimeScale(1).setEffectiveWeight(1).fadeIn(a).play())},G=!1,W=!1,B=!1,M={},V=!1,K=o=>{let a=k[o],u=a.getClip();return a&&u?u.duration:0},X=o=>{let a=o.code.toLocaleLowerCase();a=="space"&&!G&&(G=!0,L("Jump")),a=="keyj"&&!W&&(W=!0,L("Dance")),a=="keyk"&&W&&(W=!1),a=="keyt"&&!B&&(B=!0,L("Wave")),M[a]=!0,V=!0},Q=o=>{let a=o.code.toLocaleLowerCase();a=="space"&&G&&setTimeout(()=>{G=!1},K("Jump")*800),M[a]=!1,V=!1,a=="keyv"&&(F=F==s?i:s),a=="keyt"&&B&&setTimeout(()=>{B=!1},K("Wave")*800)},Z=o=>{m.rotation.y-=o.movementX*.003,v.rotation.x+=o.movementY*.003,v.rotation.x>Math.PI/8?v.rotation.x=Math.PI/8:v.rotation.x<-Math.PI/8&&(v.rotation.x=-Math.PI/8)},de=o=>{let a=e.value;a.requestPointerLock=a.requestPointerLock||a.mozRequestPointerLock||a.webkitRequestPointerLock,a.requestPointerLock&&a.requestPointerLock()},he=o=>{let a=new h;if(m.getWorldDirection(a),new h,new h(0,0,.06).length(),M.keyw){z.z=1;let f=new h(0,0,0);m.getWorldDirection(f),p.add(f.multiplyScalar(o))}else if(M.keys){z.z=1;let f=new h(0,0,0);m.getWorldDirection(f),p.add(f.multiplyScalar(-o))}else if(M.keya){z.z=1;let f=new h(0,0,0);m.getWorldDirection(f),f.cross(m.up),p.add(f.multiplyScalar(-o))}else if(M.keyd){z.z=1;let f=new h(0,0,0);m.getWorldDirection(f),f.cross(m.up),p.add(f.multiplyScalar(o))}M.space&&(p.y=5)},ue=()=>{let o=T.capsuleIntersect(b);J=!1,o&&(J=o.normal.y>0,b.translate(o.normal.multiplyScalar(o.depth)))},fe=o=>{let a=-.5;J?(p.y=0,V||p.addScaledVector(p,a)):p.y+=ae*o;let u=p.clone().multiplyScalar(o);b.translate(u),b.getCenter(m.position),ue();let f=Math.abs(p.x)+Math.abs(p.z);f>.1&&f<=5?L("Walking"):f>5?L("Running"):!W&&!B&&L("Idle")},me=()=>{m.position.y<-20&&(b.start.set(0,2.35,0),b.end.set(0,3.35,0),b.radius=.35,p.set(0,0,0),z.set(0,0,0))};const pe=new _e;let $=()=>{s.aspect=window.innerWidth/window.innerHeight,s.updateProjectionMatrix(),n.setSize(window.innerWidth,window.innerHeight),n.setPixelRatio(window.devicePixelRatio)};De(()=>{e.value.appendChild(n.domElement),window.addEventListener("keydown",X),window.addEventListener("keyup",Q),e.value.addEventListener("mousemove",Z),e.value.addEventListener("mousedown",de),window.addEventListener("resize",$)}),Re(()=>{window.removeEventListener("resize",$),window.removeEventListener("keydown",X),window.removeEventListener("keyup",Q),e.value.removeEventListener("mousemove",Z),e.value.removeEventListener("mousedown",()=>{let o=e.value;o.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,o.exitPointerLock&&o.exitPointerLock()})});function ee(){let o=pe.getDelta();he(o),fe(o),me(),D&&D.update(o),n.render(t,F),requestAnimationFrame(ee)}return ee(),(o,a)=>(He(),Ge("div",{id:"box1",ref_key:"wanderScene",ref:e},null,512))}},Qe=Ee(je,[["__scopeId","data-v-0672402d"]]);export{Qe as default};
